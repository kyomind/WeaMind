[![WeaMind CI](https://github.com/kyomind/WeaMind/actions/workflows/ci.yml/badge.svg)](https://github.com/kyomind/WeaMind/actions/workflows/ci.yml)
[![CodeQL](https://github.com/kyomind/WeaMind/actions/workflows/codeql.yml/badge.svg)](https://github.com/kyomind/WeaMind/security/code-scanning)
[![codecov](https://codecov.io/gh/kyomind/WeaMind/branch/main/graph/badge.svg)](https://codecov.io/gh/kyomind/WeaMind)
[![SonarCloud](https://sonarcloud.io/api/project_badges/measure?project=kyomind_WeaMind&metric=sqale_rating)](https://sonarcloud.io/summary/overall?id=kyomind_WeaMind)
[![Ask DeepWiki](https://deepwiki.com/badge.svg)](https://deepwiki.com/kyomind/WeaMind)
[![Ruff](https://img.shields.io/endpoint?url=https://raw.githubusercontent.com/astral-sh/ruff/main/assets/badge/v2.json)](https://github.com/astral-sh/ruff)
[![uv](https://img.shields.io/endpoint?url=https://raw.githubusercontent.com/astral-sh/uv/main/assets/badge/v0.json)](https://github.com/astral-sh/uv)

A smart LINE bot for Taiwan weather updates. See [DeepWiki](https://deepwiki.com/kyomind/WeaMind) for details.

WeaMind æ˜¯ä¸€å€‹æ™ºæ…§å¤©æ°£ LINE Botï¼Œé€éç°¡å–®çš„æ“ä½œæˆ–æ–‡å­—æŸ¥è©¢ï¼Œæä¾›å³æ™‚å°ç£å¤©æ°£è³‡è¨Šã€‚

æœ¬æœå‹™å®Œå…¨**å…è²»**ï¼Œå¦‚æœå°ä½ æœ‰å¹«åŠ©ï¼Œæ­¡è¿[è´ŠåŠ©æˆ‘ä¸€æ¯å’–å•¡](https://portaly.cc/kyomind/support)ï¼Œæˆ–é»æ“Šå³ä¸Šè§’çš„ â­ï¸ æ”¯æŒæˆ‘ã€‚

## ä½¿ç”¨èªªæ˜

åŠ å…¥ WeaMind ç‚ºå¥½å‹å¾Œï¼Œé»æ“ŠèŠå¤©è¦–çª—ä¸‹æ–¹çš„ã€ŒåŠŸèƒ½é¸å–®ã€å³å¯é–‹å§‹ä½¿ç”¨ã€‚

![WeaMind](https://img.kyomind.tw/2352352we-min-20250929-222126.png)

### 1. æ™ºæ…§æ–‡å­—æœå°‹
- ç›´æ¥è¼¸å…¥ã€ŒäºŒç´šè¡Œæ”¿å€ã€åç¨±ï¼Œæ¯”å¦‚ã€Œ`å¤§å®‰å€`ã€ã€ã€Œ`æ°´ä¸Š`ã€ã€ã€Œ`ä¸­å£¢`ã€ç­‰ï¼Œå°‡é€²è¡Œåœ°åçš„æ¨¡ç³Šæ¯”å°ã€‚
- ç³»çµ±æœƒè‡ªå‹•è­˜åˆ¥ä¸¦å›å‚³è©²åœ°å€çš„å¤©æ°£è³‡è¨Šã€‚

### 2. è¨­å®šä½å®¶ã€å…¬å¸ï¼Œä¸€éµæŸ¥è©¢å¤©æ°£
- é€éã€Œ`è¨­å®šåœ°é»`ã€åŠŸèƒ½ï¼Œé å…ˆè¨­å®šå¸¸ç”¨åœ°å€ã€‚
- é»æ“Šã€Œ`æŸ¥ä½å®¶`ã€æˆ–ã€Œ`æŸ¥å…¬å¸`ã€ç«‹å³å–å¾—è©²åœ°å€çš„å®Œæ•´å¤©æ°£è³‡è¨Šã€‚

### 3. å¿«é€Ÿé‡è¤‡æŸ¥è©¢
- ã€Œ`æœ€è¿‘æŸ¥é`ã€æœƒè¨˜éŒ„æ‚¨æœ€è¿‘æŸ¥è©¢éçš„ **5 å€‹åœ°é»**ï¼ˆä¸å«ä½å®¶èˆ‡å…¬å¸ï¼‰ã€‚
- é»æ“Šå¾Œé‡æ–°æŸ¥è©¢ï¼Œç„¡éœ€é‡è¤‡è¼¸å…¥åœ°å€ã€‚

### 4. åœ°åœ–æŸ¥è©¢
- é»æ“Šã€Œ`åœ°åœ–æŸ¥è©¢`ã€æœƒé–‹å•Ÿ LINE åœ°åœ–ä»‹é¢ã€‚
- ç›´æ¥åœ¨åœ°åœ–ä¸Šé¸æ“‡ä½ç½®ï¼Œç³»çµ±æœƒè‡ªå‹•å–å¾—è©²åœ°é»è³‡è¨Šä¸¦æŸ¥è©¢ç•¶åœ°å¤©æ°£ã€‚
- ä¸é™æ–¼ç›®å‰æ‰€åœ¨ä½ç½®ï¼Œä½ å¯ä»¥æŸ¥è©¢**ä»»æ„åœ°é»**çš„å¤©æ°£ã€‚

## åŠ å…¥å¥½å‹ï¼Œé–‹å§‹ä½¿ç”¨

1. æƒæä¸‹æ–¹ QR Codeï¼ˆæ¨è–¦ï¼‰æˆ–æœå°‹ LINE ID `@370ndhmf` åŠ å…¥ WeaMindã€‚
2. ä½¿ç”¨åŠŸèƒ½é¸å–®é–‹å§‹æŸ¥è©¢å¤©æ°£è³‡è¨Šã€‚

ç«‹å³é«”é©—æ™ºæ…§å¤©æ°£æŸ¥è©¢ï¼Œè®“å¤©æ°£è³‡è¨Šéš¨æ‰‹å¯å¾—ï¼

![WeaMind QR Code](https://img.kyomind.tw/wea-qrcode-min-20250929-223022.png)

## é–‹ç™¼è€…æŠ€è¡“äº®é»

```mermaid
graph TB
    LINE[LINE Platform]
    REDIS[(Redis<br/>åˆ†æ•£å¼é–)]
    DB[(PostgreSQL<br/>ä¸»è³‡æ–™åº«)]
    DATA[weamind-data<br/>å¾®æœå‹™]

    subgraph FASTAPI["FastAPI LINE Bot App"]
        WEB[Webhook Handler]
        BG[Background Tasks]
    end

    LINE -->|Webhook| WEB
    WEB -->|Fast ACK<br/>æ•¸åæ¯«ç§’| LINE
    WEB -->|éé˜»å¡| BG
    BG -->|é¸æ“‡æ€§é–å®š| REDIS
    BG <-->|è³‡æ–™è®€å¯«| DB
        BG -->|å›æ‡‰ç”¨æˆ¶<br/>< 3 ç§’| LINE
    DATA -->|æ¯ 6 å°æ™‚<br/>ETL æ›´æ–°| DB
```

### ğŸš€ Fast ACK Webhook æ¶æ§‹
- **æ•¸åæ¯«ç§’ ACK**ï¼šWebhook Handler æ”¶åˆ°è«‹æ±‚å¾Œç«‹å³é©—è­‰ä¸¦å›æ‡‰ï¼Œé¿å…å¹³å°é‡é€
- **3 ç§’å…§å›æ‡‰ç”¨æˆ¶**ï¼šæ¡ç”¨ã€Œå¿«é€Ÿ ACKâ†’èƒŒæ™¯è™•ç†â†’å›æ‡‰ç”¨æˆ¶ã€çš„éåŒæ­¥æµç¨‹
- **èƒŒæ™¯ä»»å‹™è™•ç†**ï¼šä½¿ç”¨ FastAPI BackgroundTasksï¼Œé¿å…æ¥­å‹™é‚è¼¯é˜»å¡ ACK
- **éŒ¯èª¤éš”é›¢**ï¼šå¾Œå°ä¾‹å¤–ä¸å½±éŸ¿ webhook æˆåŠŸå›æ‡‰ï¼Œé˜²æ­¢ LINE å¹³å°é‡é€

### ğŸ”’ Redis åˆ†æ•£å¼ä¸¦è¡Œæ§åˆ¶
- **å›ºå®š TTL è¨­è¨ˆ**ï¼š2 ç§’è‡ªå‹•é‡‹æ”¾é–ï¼Œç°¡åŒ–å¯¦ä½œä¸¦é˜²è­·å¿«é€Ÿé»æ“Š
- **Fail-Open ç­–ç•¥**ï¼šRedis æœå‹™ç•°å¸¸æ™‚å…è¨±è«‹æ±‚é€šéï¼Œå„ªå…ˆä¿è­‰æœå‹™å¯ç”¨æ€§
- **é¸æ“‡æ€§é–å®š**ï¼šåƒ…å° Rich Menu PostBack ç­‰é«˜é¢¨éšªæ“ä½œåŠ é–ï¼Œæ–‡å­—è¼¸å…¥ç„¡é–

### ğŸ—ºï¸ æ™ºæ…§ä½ç½®è§£æå¼•æ“
- **å››å±¤æœå°‹ç­–ç•¥**ï¼šç²¾ç¢ºåŒ¹é… â†’ ç¸£å¸‚åŒ¹é… â†’ é„‰é®å¸‚å€åŒ¹é… â†’ æ¨¡ç³ŠåŒ¹é…
- **åœ°å€å„ªå…ˆ + GPS å‚™æ´**ï¼šLINE GPS åˆ†äº«æ™‚å„ªå…ˆè§£æåœ°å€ï¼Œå¤±æ•—æ‰ç”¨åº§æ¨™è¨ˆç®—æœ€è¿‘ä½ç½®
- **å°ç£è¡Œæ”¿å€åŠƒå®Œæ•´æ”¯æ´**ï¼šç¸£å¸‚ã€é„‰é®å¸‚å€äºŒç´šè¡Œæ”¿å€åŠƒé©—è­‰èˆ‡æ­£è¦åŒ–
- **æ™ºæ…§å›é¥‹æ©Ÿåˆ¶**ï¼šæ ¹æ“šæœå°‹çµæœæ•¸é‡ï¼ˆ0/1/2-3/>3ï¼‰æä¾›ä¸åŒä½¿ç”¨è€…å¼•å°

### ğŸ—ï¸ Domain-Driven Design æ¶æ§‹
- **æ¸…æ™°é ˜åŸŸé‚Šç•Œ**ï¼š`core`ï¼ˆåŸºç¤è¨­æ–½ï¼‰ã€`user`ï¼ˆä½¿ç”¨è€…ç®¡ç†ï¼‰ã€`line`ï¼ˆLINE Botï¼‰ã€`weather`ï¼ˆå¤©æ°£æœå‹™ï¼‰
- **ä¾è³´åè½‰**ï¼šFastAPI ä¾è³´æ³¨å…¥æ©Ÿåˆ¶ï¼Œä¾¿æ–¼æ¸¬è©¦èˆ‡æ¨¡çµ„æ›¿æ›
- **å‹åˆ¥å®‰å…¨è¨­è¨ˆ**ï¼šå…¨å°ˆæ¡ˆ type hints è¦†è“‹ï¼ŒPyright éœæ…‹æª¢æŸ¥

### ğŸ§ª pytest å–®å…ƒæ¸¬è©¦é«”ç³»
- **å®Œæ•´æ¸¬è©¦è¦†è“‹**ï¼š32+ æ¸¬è©¦æª”æ¡ˆæ¶µè“‹ coreã€lineã€weatherã€user å„é ˜åŸŸæ¨¡çµ„
- **æ¸¬è©¦ç’°å¢ƒéš”é›¢**ï¼šSQLite è¨˜æ†¶é«”è³‡æ–™åº« + fixtures è¨­è¨ˆï¼Œç¢ºä¿æ¸¬è©¦ç¨ç«‹æ€§
- **éåŒæ­¥æ¸¬è©¦æ”¯æ´**ï¼špytest-asyncio å®Œç¾é©é… FastAPI éåŒæ­¥ç‰¹æ€§
- **è‡ªå‹•åŒ–è¦†è“‹ç‡**ï¼špytest-cov æ•´åˆï¼Œè‡ªå‹•ç”Ÿæˆè¦†è“‹ç‡å ±å‘Šä¸¦ä¸Šå‚³ Codecov

### ğŸ› ï¸ ç¾ä»£åŒ–é–‹ç™¼å·¥å…·éˆ
- **uv å¥—ä»¶ç®¡ç†**ï¼šæ›¿ä»£ pip + venvï¼Œçµ±ä¸€ `uv run` æŒ‡ä»¤åŸ·è¡Œ
- **Ruff éœæ…‹æª¢æŸ¥èˆ‡æ ¼å¼åŒ–**ï¼šæ•´åˆ linting + formattingï¼Œå–ä»£ black + isort + flake8
- **pre-commit hooks**ï¼šé€é pre-commit å·¥å…·è¨­å®š Git hooksï¼Œæ–¼ commit å‰è‡ªå‹•åŸ·è¡Œç¨‹å¼ç¢¼æª¢æŸ¥
- **å¤šé‡å®‰å…¨æƒæ**ï¼šBanditï¼ˆéœæ…‹å®‰å…¨ï¼‰ã€pip-auditï¼ˆCVE æª¢æŸ¥ï¼‰ã€detect-secretsï¼ˆæ•æ„Ÿè³‡æ–™é˜²è­·ï¼‰

### ğŸ”„ å®Œæ•´ CI Pipeline
- **é›™è»Œ GitHub Actions**ï¼šä¸» CI æµç¨‹ + CodeQL å®‰å…¨åˆ†æ
- **å®¹å™¨åŒ–é©—è­‰**ï¼šæ¯æ¬¡ PR è‡ªå‹•é©—è­‰ Docker image å®Œæ•´æ€§
- **å¤šå±¤ç´šç¨‹å¼ç¢¼å“è³ªæª¢æŸ¥**ï¼šRuff â†’ Pyright â†’ Bandit â†’ pip-audit â†’ pytest ä¾åºåŸ·è¡Œ
- **è‡ªå‹•åŒ–ç™¼å¸ƒ**ï¼šGit tag è§¸ç™¼è‡ªå‹•ç‰ˆæœ¬ç™¼å¸ƒèˆ‡ release notes ç”Ÿæˆ
- **Dependabot æ•´åˆ**ï¼šæ¯é€±è‡ªå‹•æª¢æŸ¥ Python å¥—ä»¶èˆ‡ GitHub Actions å®‰å…¨æ›´æ–°
- **Codecov æ•´åˆ**ï¼šæ¸¬è©¦è¦†è“‹ç‡è‡ªå‹•ä¸Šå‚³èˆ‡ PR å ±å‘Š
- **SonarCloud éœæ…‹åˆ†æ**ï¼šæŒçºŒç›£æ§ç¨‹å¼ç¢¼å“è³ªï¼Œæä¾›å®‰å…¨æ€§èˆ‡æŠ€è¡“å‚µå‹™å ±å‘Š

### ğŸ“¦ å®¹å™¨åŒ–èˆ‡éƒ¨ç½²
- **å¤šç’°å¢ƒ Docker Compose**ï¼šé–‹ç™¼ã€æ¸¬è©¦ã€ç”Ÿç”¢ç’°å¢ƒè¨­å®šç¹¼æ‰¿
- **Alembic è³‡æ–™åº«é·ç§»**ï¼šç‰ˆæœ¬åŒ– schema ç®¡ç†ï¼Œæ”¯æ´å‘å‰å‘å¾Œé·ç§»
- **å¥åº·æª¢æŸ¥æ©Ÿåˆ¶**ï¼šå®¹å™¨èˆ‡æ‡‰ç”¨ç¨‹å¼å±¤ç´šçš„å¤šé‡å¥åº·ç›£æ§

---

è©³ç´°æŠ€è¡“æ¶æ§‹è«‹åƒè€ƒï¼š
- [å°ˆæ¡ˆæ¶æ§‹](docs/Architecture-Code.md) - å®Œæ•´ç¨‹å¼ç¢¼æ¶æ§‹èªªæ˜
- [DeepWiki æŠ€è¡“æ–‡ä»¶](https://deepwiki.com/kyomind/WeaMind) - äº’å‹•å¼æŠ€è¡“æ¢ç´¢
