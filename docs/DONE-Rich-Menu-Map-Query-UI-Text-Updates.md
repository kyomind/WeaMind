# ğŸ“ Rich Menu åœ°åœ–æŸ¥è©¢åŠŸèƒ½UIæ–‡å­—å„ªåŒ–å¯¦ä½œç´€éŒ„

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

**é–‹ç™¼åˆ†æ”¯**: `feature/map-query-ui-text-updates`
**é–‹ç™¼æ™‚é–“**: 2025å¹´9æœˆ11æ—¥
**å®Œæˆç‹€æ…‹**: âœ… å·²å®Œæˆä¸¦éƒ¨ç½²æ–°çš„Rich Menu

é‡å°WeaMind LINE Botçš„ã€Œç›®å‰ä½ç½®ã€åŠŸèƒ½é€²è¡ŒUIæ–‡å­—å„ªåŒ–ï¼Œè§£æ±ºç”¨æˆ¶å°åŠŸèƒ½ç†è§£çš„èª¤å€ï¼Œä¸¦æ›´æº–ç¢ºåœ°åæ˜ å¯¦éš›çš„ä½¿ç”¨é«”é©—ã€‚

## ğŸ¯ å•é¡Œåˆ†æèˆ‡æŠ€è¡“æ±ºç­–

### æ ¸å¿ƒå•é¡Œè­˜åˆ¥

**åŸå§‹å•é¡Œ**:
- Rich MenuæŒ‰éˆ•æ¨™ç±¤ã€Œç›®å‰ä½ç½®ã€æš—ç¤ºè‡ªå‹•GPSå®šä½
- å¯¦éš›åŠŸèƒ½æ˜¯LINEåœ°åœ–æ‰‹å‹•é¸é»
- ç”¨æˆ¶æœŸå¾…èˆ‡å¯¦éš›é«”é©—å­˜åœ¨è½å·®
- ã€Œç›®å‰ä½ç½®ã€å¸¶æœ‰éš±ç§å£“åŠ›æ„Ÿ

**æŠ€è¡“åˆ†æ**:
```
ç”¨æˆ¶æœŸå¾…: è‡ªå‹•GPS â†’ ç•¶å‰çœŸå¯¦ä½ç½®
å¯¦éš›åŠŸèƒ½: åœ°åœ–é¸é» â†’ ç”¨æˆ¶æŒ‡å®šä»»æ„ä½ç½®
```

### è¨­è¨ˆåŸå‰‡åˆ¶å®š

**è¨Šæ¯æµè¨­è¨ˆåŸå‰‡**: ã€Œç´°ç¯€å¾å°‘åˆ°å¤šã€
1. **Rich MenuæŒ‰éˆ•**: æœ€ç°¡æ½”ï¼Œå¸å¼•é»æ“Š
2. **PostBacké¡¯ç¤ºæ–‡å­—**: é©ä¸­è©³ç´°ï¼Œç¢ºèªæ“ä½œ
3. **æ“ä½œæç¤ºè¨Šæ¯**: æœ€è©³ç´°ï¼ŒæŒ‡å°æ“ä½œ

**æ–‡å­—ç­–ç•¥**:
- å»é™¤éš±ç§æ„Ÿæš—ç¤º
- çªå‡ºåŠŸèƒ½è³£é»ï¼ˆå°ç£ä»»æ„ä½ç½®ï¼Œç„¡éœ€è¼¸å…¥æ–‡å­—ï¼‰
- æº–ç¢ºæè¿°æ“ä½œæµç¨‹

## ğŸ”§ æŠ€è¡“å¯¦ä½œæ–¹æ¡ˆ

### æ ¸å¿ƒæ¶æ§‹

```
LINE Bot Rich Menu â†’ PostBack Event â†’ Location Request â†’ Map Selection
     â†“                    â†“                 â†“               â†“
  åœ°åœ–æŸ¥è©¢         ä¾åœ°åœ–æŸ¥è©¢å¤©æ°£    é–‹å•Ÿåœ°åœ–é¸æ“‡    é»é¸ä»»æ„ä½ç½®
```

### é—œéµæª”æ¡ˆä¿®æ”¹

#### 1. Rich Menué…ç½® (`docs/rich_menu/rich_menu_config.json`)

**ä¿®æ”¹å‰**:
```json
{
    "action": {
        "type": "postback",
        "data": "action=weather&type=current",
        "displayText": "æŸ¥ç›®å‰ä½ç½®å¤©æ°£"
    }
}
```

**ä¿®æ”¹å¾Œ**:
```json
{
    "action": {
        "type": "postback",
        "data": "action=weather&type=current",
        "displayText": "ä¾åœ°åœ–æŸ¥è©¢å¤©æ°£"
    }
}
```

**æŠ€è¡“æ±ºç­–**: ä¿æŒPostBack dataä¸è®Šï¼Œç¢ºä¿å¾Œç«¯é‚è¼¯ç›¸å®¹æ€§

#### 2. LINEæœå‹™é‚è¼¯ (`app/line/service.py`)

**æ ¸å¿ƒå‡½å¼**: `handle_current_location_weather()`

**ä¿®æ”¹å‰**:
```python
message_text = "è«‹åˆ†äº«æ‚¨çš„ä½ç½®ï¼Œæˆ‘å°‡ç‚ºæ‚¨æŸ¥è©¢ç•¶åœ°å¤©æ°£"
action=LocationAction(
    type="location",
    label="åˆ†äº«æˆ‘çš„ä½ç½®"
)
```

**ä¿®æ”¹å¾Œ**:
```python
message_text = "è«‹é»é»åœ°åœ–ä¸Šä»»æ„ä½ç½®ï¼Œæˆ‘å°‡ç‚ºæ‚¨æŸ¥è©¢è©²åœ°å¤©æ°£"
action=LocationAction(
    type="location",
    label="é–‹å•Ÿåœ°åœ–é¸æ“‡"
)
```

**æŠ€è¡“æ±ºç­–**: ç¶­æŒLocationActionæ¶æ§‹ï¼Œåƒ…èª¿æ•´ç”¨æˆ¶ä»‹é¢æ–‡å­—

#### 3. Rich Menuè¦–è¦ºè¨­è¨ˆ (`docs/rich_menu/rich_menu_template.svg`)

**ä¿®æ”¹å…§å®¹**:
- æŒ‰éˆ•æ–‡å­—: `ç›®å‰ä½ç½®` â†’ `åœ°åœ–æŸ¥è©¢`
- è¨»è§£æ›´æ–°: çµ±ä¸€è¡“èªä½¿ç”¨

### å®Œæ•´ä¿®æ”¹æ¸…å–®

| æª”æ¡ˆé¡å‹      | æª”æ¡ˆè·¯å¾‘                                | ä¿®æ”¹å…§å®¹                  |
| ------------- | --------------------------------------- | ------------------------- |
| Rich Menué…ç½® | `docs/rich_menu/rich_menu_config.json`  | PostBacké¡¯ç¤ºæ–‡å­—          |
| å¾Œç«¯æœå‹™      | `app/line/service.py`                   | æç¤ºè¨Šæ¯ã€Quick Replyæ¨™ç±¤ |
| è¦–è¦ºè¨­è¨ˆ      | `docs/rich_menu/rich_menu_template.svg` | æŒ‰éˆ•æ–‡å­—ã€è¨»è§£            |
| å¹«åŠ©æ–‡æª”      | `static/help/index.html`                | åŠŸèƒ½èªªæ˜ã€ä½¿ç”¨æç¤º        |
| è¨­è¨ˆæ–‡æª”      | `docs/rich_menu/README.md`              | æ ¼å­åˆ†å‰²èªªæ˜ã€åœ–ç¤ºå»ºè­°    |
| é è¦½é é¢      | `docs/rich_menu/archive/preview.html`   | æŒ‰éˆ•æ¨™é¡Œ                  |
| æ¸¬è©¦æª”æ¡ˆ      | `tests/line/test_postback.py`           | æ–·è¨€å…§å®¹                  |
| å…¬å‘Šå…§å®¹      | `static/announcements.json`             | åŠŸèƒ½ä»‹ç´¹                  |

## ğŸš€ éƒ¨ç½²æµç¨‹

### 1. åˆ†æ”¯ç®¡ç†
```bash
git checkout -b feature/map-query-ui-text-updates
```

### 2. æ–‡å­—å…§å®¹æ›´æ–°
- ä½¿ç”¨VS Codeçš„replace_string_in_fileå·¥å…·
- ç¢ºä¿ä¸Šä¸‹æ–‡åŒ¹é…ï¼Œé¿å…èª¤ä¿®æ”¹
- åŒæ­¥æ›´æ–°æ‰€æœ‰ç›¸é—œæª”æ¡ˆ

### 3. Rich Menuéƒ¨ç½²
```bash
make upload IMAGE=docs/rich_menu/rich_menu.png
```

**éƒ¨ç½²çµæœ**:
- æ–°Rich Menu ID: `richmenu-133053dd2e7375a8ab18ced0deb51708`
- è‡ªå‹•è¨­å®šç‚ºé è¨­é¸å–®
- å³æ™‚ç”Ÿæ•ˆæ–¼æ‰€æœ‰ç”¨æˆ¶

## ğŸ§ª æ¸¬è©¦é©—è­‰

### åŠŸèƒ½æ¸¬è©¦
1. **Rich Menué¡¯ç¤º**: âœ… æŒ‰éˆ•æ–‡å­—æ­£ç¢ºé¡¯ç¤ºã€Œåœ°åœ–æŸ¥è©¢ã€
2. **PostBackäº‹ä»¶**: âœ… é»æ“Šå¾Œé¡¯ç¤ºã€Œä¾åœ°åœ–æŸ¥è©¢å¤©æ°£ã€
3. **ä½ç½®è«‹æ±‚**: âœ… æç¤ºè¨Šæ¯æº–ç¢ºæè¿°æ“ä½œ
4. **Quick Reply**: âœ… æŒ‰éˆ•æ¨™ç±¤ç‚ºã€Œé–‹å•Ÿåœ°åœ–é¸æ“‡ã€

### è‡ªå‹•åŒ–æ¸¬è©¦æ›´æ–°
```python
# æ›´æ–°æ¸¬è©¦æ–·è¨€
assert message.text == "è«‹é»é»åœ°åœ–ä¸Šä»»æ„ä½ç½®ï¼Œæˆ‘å°‡ç‚ºæ‚¨æŸ¥è©¢è©²åœ°å¤©æ°£"
assert message.quick_reply.items[0].action.label == "é–‹å•Ÿåœ°åœ–é¸æ“‡"
```

## ğŸ’¡ é‡è¦æŠ€è¡“æ±ºç­–

### 1. å‘å¾Œç›¸å®¹æ€§ç¶­æŒ
**æ±ºç­–**: ä¿æŒPostBack dataæ ¼å¼ä¸è®Š
**åŸå› **:
- é¿å…å½±éŸ¿ç¾æœ‰å¾Œç«¯é‚è¼¯
- é™ä½éƒ¨ç½²é¢¨éšª
- åƒ…èª¿æ•´ç”¨æˆ¶ä»‹é¢å±¤

### 2. è¨Šæ¯å±¤ç´šè¨­è¨ˆ
**æ±ºç­–**: æ¡ç”¨ã€Œç´°ç¯€å¾å°‘åˆ°å¤šã€åŸå‰‡
**åŸå› **:
- ç¬¦åˆç”¨æˆ¶èªçŸ¥ç¿’æ…£
- é¿å…è³‡è¨Šéè¼‰
- æä¾›æ¼¸é€²å¼å¼•å°

### 3. è¡“èªçµ±ä¸€æ¨™æº–åŒ–
**æ±ºç­–**: å…¨é¢ä½¿ç”¨ã€Œåœ°åœ–æŸ¥è©¢ã€è¡“èª
**åŸå› **:
- æ¶ˆé™¤åŠŸèƒ½ç†è§£æ­§ç¾©
- çªå‡ºæ ¸å¿ƒè³£é»
- é™ä½éš±ç§é¡§æ…®

## ğŸ” æ ¸å¿ƒç¨‹å¼ç¢¼é‚è¼¯

### PostBackäº‹ä»¶è·¯ç”±
```python
@webhook_handler.add(PostbackEvent)
def handle_postback_event(event: PostbackEvent) -> None:
    postback_data = parse_postback_data(event.postback.data)

    if postback_data.get("action") == "weather":
        if postback_data.get("type") == "current":
            handle_current_location_weather(event)  # åœ°åœ–æŸ¥è©¢æµç¨‹
```

### ä½ç½®è«‹æ±‚è™•ç†
```python
def handle_current_location_weather(event: PostbackEvent) -> None:
    """è™•ç†åœ°åœ–æŸ¥è©¢PostBack - è«‹æ±‚ç”¨æˆ¶é¸æ“‡ä½ç½®"""
    message_text = "è«‹é»é»åœ°åœ–ä¸Šä»»æ„ä½ç½®ï¼Œæˆ‘å°‡ç‚ºæ‚¨æŸ¥è©¢è©²åœ°å¤©æ°£"

    quick_reply_items = [
        QuickReplyItem(
            action=LocationAction(
                type="location",
                label="é–‹å•Ÿåœ°åœ–é¸æ“‡"
            )
        )
    ]
```

### ä½ç½®è³‡è¨Šè™•ç†
```python
@webhook_handler.add(MessageEvent, message=LocationMessageContent)
def handle_location_message_event(event: MessageEvent) -> None:
    """è™•ç†ç”¨æˆ¶åœ°åœ–é¸æ“‡çš„ä½ç½®è³‡è¨Š"""
    lat = message.latitude
    lon = message.longitude
    address = getattr(message, "address", None)

    # ä½¿ç”¨åœ°å€å„ªå…ˆ + GPSå‚™æ´ç­–ç•¥
    response_message = WeatherService.handle_location_weather_query(
        session, lat, lon, address
    )
```

## ğŸ“Š æ•ˆæœè©•ä¼°

### ç”¨æˆ¶é«”é©—æ”¹é€²
- âœ… æ¶ˆé™¤ã€Œç›®å‰ä½ç½®ã€éš±ç§é¡§æ…®
- âœ… æº–ç¢ºæè¿°å¯¦éš›æ“ä½œæµç¨‹
- âœ… çªå‡ºç„¡éœ€è¼¸å…¥æ–‡å­—çš„ä¾¿åˆ©æ€§
- âœ… é™ä½åŠŸèƒ½ç†è§£é–€æª»

### æŠ€è¡“å“è³ªæå‡
- âœ… çµ±ä¸€è¡“èªä½¿ç”¨
- âœ… å®Œå–„æ¸¬è©¦è¦†è“‹
- âœ… æ–‡æª”åŒæ­¥æ›´æ–°
- âœ… å‘å¾Œç›¸å®¹æ€§ç¶­æŒ

## ğŸ”® å¾ŒçºŒå„ªåŒ–å»ºè­°

### çŸ­æœŸå„ªåŒ–
1. **ç”¨æˆ¶è¡Œç‚ºç›£æ§**: è¿½è¹¤åœ°åœ–æŸ¥è©¢ä½¿ç”¨ç‡è®ŠåŒ–
2. **éŒ¯èª¤è™•ç†å¼·åŒ–**: åœ°åœ–é¸æ“‡å¤±æ•—çš„fallbackæ©Ÿåˆ¶
3. **ä½¿ç”¨è€…å›é¥‹æ”¶é›†**: æ–°æ–‡å­—æ˜¯å¦æ›´æ¸…æ¥šæ˜“æ‡‚

### é•·æœŸè¦åŠƒ
1. **åœ°åœ–åŠŸèƒ½æ“´å±•**: è€ƒæ…®æ•´åˆæ›´å¤šåœ°åœ–ç›¸é—œåŠŸèƒ½
2. **å€‹äººåŒ–é«”é©—**: æ ¹æ“šç”¨æˆ¶ç¿’æ…£èª¿æ•´ä»‹é¢æ–‡å­—
3. **å¤šèªè¨€æ”¯æ´**: ç‚ºä¸åŒèªè¨€ç”¨æˆ¶å„ªåŒ–è¡¨é”æ–¹å¼

## ğŸ“š ç›¸é—œæ–‡æª”

- **Rich Menuç®¡ç†æŒ‡å—**: `.github/prompts/rich-menu.prompt.md`
- **è¨­è¨ˆè¦æ ¼**: `docs/rich_menu/README.md`
- **æ¶æ§‹èªªæ˜**: `docs/Architecture.md`
- **æ¸¬è©¦æŒ‡å—**: `.github/instructions/testing-guidelines.instructions.md`

---

**é–‹ç™¼è€…**: GitHub Copilot (AI Assistant)
**å¯©æ ¸è€…**: kyomind
**éƒ¨ç½²æ™‚é–“**: 2025å¹´9æœˆ11æ—¥
**Rich Menu ID**: `richmenu-133053dd2e7375a8ab18ced0deb51708`
