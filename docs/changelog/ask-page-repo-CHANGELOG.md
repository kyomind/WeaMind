# 變更日誌

所有重要變更都會記錄在此檔案中。

格式基於 [Keep a Changelog](https://keepachangelog.com/zh-TW/1.0.0/)，並且本專案遵循 [語意化版本](https://semver.org/lang/zh-TW/)。

## [0.6.0] - 2025-08-02

### 新增

- **全頁面設定介面**: 將原本的彈出視窗設定改為全頁面設定界面，提供更寬敞的操作空間
  - 響應式設計，支援桌面和行動裝置
  - 現代化的卡片式佈局，提升視覺體驗
  - 更清晰的分類標籤頁設計
- **自訂斜線命令系統**: 全新的自訂斜線命令管理功能
  - 使用者可以新增、編輯、刪除自訂斜線命令
  - 每個自訂命令包含命令名稱（必須以 / 開頭）和提示內容
  - 內建命令和自訂命令的統一管理界面
  - 自訂命令會自動整合到智慧提示（intellisense）系統
  - 命令名稱驗證，確保格式正確性（只能包含字母、數字、底線和連字符）
- **動態命令列表**: 對話框的歡迎訊息會動態顯示使用者的自訂命令
  - 顯示自訂命令名稱和簡化的提示內容預覽
  - 引導使用者前往設定頁面管理更多命令
- **未知命令處理**: 當使用者輸入未定義的斜線命令時，提供友善的錯誤訊息和可用命令列表

### 改進

- **擴充功能設定方式**: 從彈出視窗改為全頁面設定，通過右鍵點擊擴充功能圖示選擇「選項」進入設定
- **命令管理體驗**: 內建命令（/clear、/summary、/screenshot）和自訂命令使用統一的管理介面
- **智慧提示增強**: 自動完成功能現在包含所有自訂命令，並顯示命令的簡短描述
- **設定頁面體驗**: 採用現代化設計語言，支援深色/淺色主題自動切換
- **回饋訊息優化**: 更清晰的成功/錯誤狀態提示

### 技術改進

- **儲存結構擴展**: 新增 `CUSTOM_COMMANDS` 儲存鍵用於管理自訂命令
- **模組化設計**: 設定功能拆分為獨立的 `settings.html` 和 `settings.js`
- **向後相容性**: 保持所有現有功能和 API 金鑰加密機制不變

## [0.5.2] - 2025-08-02

### 修復

- **小幅修復和改進**: 版本維護更新
  - 程式碼品質改善
  - 依賴項目更新

## [0.5.1] - 2025-08-01

### 修復

- **重置設定功能修復**: 修復重置設定時 API Key 被損壞的嚴重問題
  - 修復重置邏輯中加密密鑰被意外清除的 bug
  - 改進 API Key 解密失敗時的錯誤處理和用戶提示
  - 確保重置設定時保留加密密鑰（ENCRYPTION_KEY），避免已加密的 API Key 無法解密
  - 新增明確的錯誤訊息，當解密失敗時提示用戶重新輸入 API Key
  - 保持對純文字格式 API Key 的向後兼容性

## [0.5.0] - 2025-08-01

### 新增

- **自訂 /summary 命令提示功能**: 新增可自訂總結命令提示語的功能
  - 總結提示語預設填入擴充套件預設內容：「請幫我總結這篇文章，並以 Markdown 格式輸出，內容包含「標題」、「重點摘要」、「總結」」
  - placeholder 文字顯示相同的預設提示內容，讓使用者清楚瞭解預設行為
  - 使用者可在設定中客製化總結命令的行為
- **多頁籤設定介面**: 完全重新設計擴充功能的設定介面，採用現代化的頁籤設計
  - **AI 提供者頁籤**: 集中管理 Gemini 和 OpenAI 的設定
  - **自訂斜線命令頁籤**: 管理自訂命令提示語設定
  - 響應式設計，支援深色/淺色主題自動切換
  - 頁籤切換包含平滑動畫效果
- **截圖功能狀態提醒**: 新增智慧截圖狀態提醒功能，大幅提升使用者體驗
  - **截圖功能停用時（預設狀態）**: 顯示「/screenshot - 啟用截圖功能 (預設關閉)」
  - **截圖功能啟用時**: 顯示「/screenshot - ? **截圖功能已啟用** - 停用截圖功能」
  - 額外提醒：「⚠️ **提醒：截圖功能目前為啟用狀態**」
  - 詳細說明：「系統會自動在您的提問中包含當前頁面截圖進行分析。」
- **自動回焦輸入框功能**: 新增對話框提問送出後自動回到輸入框的功能，提升操作流暢性
  - 一般提問送出後自動將鍵盤游標回到文字輸入框
  - `/clear` 命令執行後自動回焦到輸入框
  - `/screenshot` 命令執行後自動回焦到輸入框
  - 使用者體驗提升：無需手動點擊輸入框即可繼續提問
- **重置設定功能**: 新增「重置設定」按鈕，允許使用者一鍵恢復預設設定，同時保留已設定的 API Keys (Gemini 和 OpenAI)

### 改進

- **文字統一化**: 將對話框中的提示文字從「可用指令:」統一改為「內建斜線命令：」，提升使用者體驗的一致性
- **預設內容填入**: 總結提示語 textarea 現在會預設填入擴充套件的預設提示內容
- **清晰的提示文字**: placeholder 顯示完整的預設提示，讓使用者瞭解預設行為
- **動態狀態顯示**: 歡迎訊息會根據當前截圖功能狀態動態調整
- **清晰的視覺提示**: 使用醒目的圖示（?、⚠️）和粗體文字強調重要資訊
- **向後相容性**: 保持所有現有功能不變，僅增強使用者介面
- **自動回焦機制**: 提升對話互動的連續性和效率
- **設定介面優化**: 更大的設定視窗尺寸（420x520px），提供更佳的使用體驗

### 技術細節

- 新增 `CUSTOM_SUMMARY_PROMPT_STORAGE` 儲存鍵值
- 新增 `DEFAULT_SUMMARY_PROMPT` 常數確保一致性
- 動態狀態檢測：透過 `getScreenshotEnabled()` 即時檢測截圖功能狀態
- 智慧訊息生成：根據截圖狀態動態產生相應的提醒訊息和命令說明
- 視覺化回饋：使用明確的圖示和格式化文字提升可讀性
- 自動回焦實作：在 `handleAsk()` 函數的關鍵位置添加 `input.focus()` 調用
- 新增完整的頁籤導航系統和樣式
- 實作設定重置功能，保護 API Key 不被清除

## [0.4.0] - 2025-07-17

### 新增

- **截圖功能切換**: 新增 `/screenshot` 指令可以啟用/停用截圖功能
- **截圖狀態記憶**: 截圖啟用/停用狀態會自動儲存，重新載入頁面後保持設定
- **動態指令說明**: `/screenshot` 指令說明會根據目前狀態顯示「啟用截圖功能」或「停用截圖功能」

### 改進

- **預設行為變更**: 截圖功能現在預設為關閉狀態，需要手動啟用
- **使用者體驗**: 移除歡迎訊息中的自動截圖提及，改為說明截圖功能預設關閉
- **效能最佳化**: 當截圖功能停用時，不會進行不必要的截圖捕獲作業
- **狀態回饋**: 切換截圖功能時提供清楚的狀態回饋訊息

### 技術細節

- 新增 `SCREENSHOT_ENABLED_STORAGE` 儲存鍵值
- 實作 `getScreenshotEnabled()`, `setScreenshotEnabled()`, `toggleScreenshotEnabled()` 函式
- 修改 `askGemini()` 函式以條件性捕獲截圖
- 更新智慧提示系統以動態顯示正確的指令說明
- 更新歡迎訊息以反映新的預設行為

## [0.3.1] - 2025-07-17

### 修正

- **API 金鑰解密問題**: 修正從 OpenAI 切換到 Gemini 時出現「API key not valid」錯誤的問題
- **統一 API 金鑰處理**: `askGemini` 函式現在正確執行 API 金鑰解密，與 `askOpenAI` 函式保持一致
- **提升錯誤處理**: 增加更詳細的除錯日誌和錯誤訊息

## [0.3.0] - 2025-07-17

### 新增

- **多 AI 提供者支援**: 新增 OpenAI 作為第二個 AI 提供者選項
- **提供者切換功能**: 使用 `Ctrl+Shift+P` 快速切換 AI 提供者
- **OpenAI 模型支援**: 支援 8 種 OpenAI 模型
  - gpt-4o, gpt-4o-mini
  - gpt-4.1, gpt-4.1-mini
  - o4-mini, o3, o3-mini, o3-pro
- **API 金鑰加密**: 使用 AES-256-GCM 加密儲存所有 API 金鑰
- **提供者顯示**: 對話框標題顯示當前使用的 AI 提供者和模型
- **向後相容性**: 現有 Gemini API 金鑰繼續正常運作

### 修正

- **OpenAI o 系列模型**: 修正 o 系列模型 (o3, o3-mini, o3-pro, o4-mini) 的參數相容性
  - 使用 `max_completion_tokens` 而非 `max_tokens`
  - 移除不支援的 `temperature` 參數
- **CSS 樣式**: 統一設定頁面中標籤和輸入欄位的行高
- **OpenAI o 系列模型相容性**: 進一步修正 o 系列模型參數問題
  - 修正 `max_tokens` 參數問題，改用 `max_completion_tokens`
  - 完全移除 o 系列模型不支援的 `temperature` 參數
- **設定頁面 UI**: 修正欄位行高一致性問題，提升視覺體驗

### 改進

- **錯誤處理增強**: 針對 OpenAI API 的特定錯誤回應 (401, 429, 5xx)
- **重試機制**: 網路失敗時的指數退讓重試邏輯
- **安全性提升**: API 金鑰在記錄中僅顯示前後 4 個字元
- **UI 一致性**: 修正設定頁面的行高一致性問題
- **文件更新**: 更新 README.md 和 CHANGELOG.md，完善多提供者支援說明
- **版本管理**: 統一 package.json 和 manifest.json 版本號

### 技術細節

- 新增 `switch-provider` 鍵盤指令
- 實作工廠模式統一 AI 提供者介面
- 增強的錯誤處理和使用者回饋
- 最小化變更：僅新增 494 行，刪除 33 行程式碼

## [0.2.0] - 2025-07-16

### 新增

- 加入「視覺」能力，可以詢問你在當前畫面上看到的東西

## [0.1.0] - 2025-07-09

Initial release

### 新增

- 在設定頁面加入 Gemini 模型選擇下拉選單
- 支援動態切換 Gemini AI 模型
- 可選擇的模型包括：
  - gemini-2.5-pro
  - gemini-2.5-flash
  - gemini-2.5-flash-lite-preview-06-17
- 模型選擇會自動儲存並套用至後續的 AI 請求
- 預設使用 gemini-2.5-flash-lite-preview-06-17 模型
- 基本的 Chrome 擴充功能架構
- Gemini API 整合
- 對話框介面設計
- 支援選取文字提問
- 內建指令系統 (`/clear`, `/summary`)
- 提問歷史記錄功能
- 快速鍵支援 (Ctrl+I)
- Markdown 渲染支援
- HTML 內容清理 (DOMPurify)
- API Key 設定介面
- 建立完整的 CI/CD 自動化流程
- GitHub Actions 工作流程設定
- 自動化發布到 Chrome Web Store
- 程式碼品質檢查自動化
- ESLint 程式碼風格檢查
- Web Extension 驗證

### 改進

- 新增詳細的文件說明
- 建立 PUBLISH.md 發布指南
- 完善 README.md 使用說明

### 技術規格

- Manifest V3 架構
- 支援繁體中文回應
- 安全的 HTML 渲染
- 本地儲存 API Key 和歷史記錄
- 響應式設計介面

---

## 版本說明

### 版本號格式

我們使用語意化版本號: `主版本.次版本.修訂版本`

- **主版本**: 不相容的 API 變更
- **次版本**: 新增功能但向後相容
- **修訂版本**: 向後相容的錯誤修正

### 變更類型

- **新增**: 新功能
- **改進**: 現有功能的改善
- **修正**: 錯誤修正
- **安全性**: 安全性相關的修正
- **移除**: 移除的功能
- **廢棄**: 即將移除的功能

<!-- 版本鏈接 -->
[0.5.0]: https://github.com/doggy8088/ask-page-extension/compare/v0.4.0...v0.5.0
[0.4.0]: https://github.com/doggy8088/ask-page-extension/compare/v0.3.1...v0.4.0
[0.3.1]: https://github.com/doggy8088/ask-page-extension/compare/v0.3.0...v0.3.1
[0.3.0]: https://github.com/doggy8088/ask-page-extension/compare/v0.2.0...v0.3.0
[0.2.0]: https://github.com/doggy8088/ask-page-extension/compare/v0.1.0...v0.2.0
[0.1.0]: https://github.com/doggy8088/ask-page-extension/releases/tag/v0.1.0
