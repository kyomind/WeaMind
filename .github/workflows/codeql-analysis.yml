name: "CodeQL"

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  schedule:
    # 每週日 00:00 UTC（台灣時間週日 08:00）
    - cron: "0 0 * * 0"

permissions:
  actions: read
  contents: read
  security-events: write

jobs:
  codeql:
    runs-on: ubuntu-latest

    # 使用 Astral 官方 uv + Python 3.12 的輕量 Container
    container:
      image: ghcr.io/astral-sh/uv:python3.12-bookworm-slim

    steps:
      # 1. 取出原始碼
      - uses: actions/checkout@v4

      # 2. 初始化 CodeQL（先宣告語言與查詢集）
      - name: Init CodeQL
        uses: github/codeql-action/init@v3
        with:
          languages: python
          queries: security-extended # 建議掃描進階安全規則

      # 3. **自訂 Build**：用 uv 安裝鎖檔依賴，再安裝專案本身
      - name: Build with uv
        run: |
          uv sync --locked

      # 4. 分析 & 上傳結果
      - name: Analyze
        uses: github/codeql-action/analyze@v3
